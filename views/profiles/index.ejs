<%- include('../partials/html-head') %>
<link rel="stylesheet" href="../stylesheets/profiles/index.css">
<%- include('../partials/nav') %>

<main>
  <% profiles.forEach(profile => { %>
    <% if (userProfile.equals(profile._id)) { %>
    <% } else { %>
      <div class="container">
        <img 
          src="<%= profile.avatar %>" 
          alt="<%= profile.name %>'s avatar"
          class="friend-img"
        >
        <h3><%= profile.name %></h3>
        <%if (userProfile.outgoingFriendRequests.includes(profile._id)) { %>
         <button>Pending</button>
        <%} else if (userProfile.incomingFriendRequests.includes(profile._id)) { %>
          <p>sent you a friend request</p>
          <form action="/profiles/<%= profile._id %>/acceptFriend" method="POST">
            <button>Accept</button>
          </form>
          <form action="/profiles/<%= profile._id %>/declineFriend" method="POST">
            <button>Decline</button>
          </form>
        <% } else if (userProfile.friends.includes(profile._id)) { %>
          <p>You are friends</p>
          <a href="/profiles/<%= profile._id %>/show">
            <button>See Profile</button>
          </a>
        <%} else { %>
        <form action="/profiles/<%= profile._id %>/requestFriend" method="POST">
          <button>Send friend request</button>
        </form>
      </div>
      <% } %>
    <% } %>
  <% }) %>
</main>

<%- include('../partials/footer') %>
